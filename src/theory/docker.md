# Docker

### Из чего состоит Docker:
- `Images` - ReadOnly образы
- `Containers` - Запускаемая сущность, оперирующая образом
- `Registries` - Место где хранятся образы

### Volumes
Тома - это часть обычной файловой системы хоста,
которые монтируются в файловую систему контейнера как внешнее устройство.

= Все изменения на хосте так-же будут монтироваться и в контейнер!

3 различных способа инициализации:
- флаг `-v`: `docker run -v /data ubuntu`
- volume in Dockerfile: `VOLUME /data`
- Через `docker-compose.yml`: `- ./host_dir:/path/to/container_dir`

### Docker-workflow
`image` - это готовый к запуску образ. Контейнер это запущенный и работающий образ.
В контейнере к образу на самом верхнем уровне добавляется слой файловой системы
с возможностью записи (при остановке контейнера, этот уровень пропадает).
Одновременно с этим инициализируются различные параметры настройки,
такие как ip-adres, name, container_id и всякие ограничения ресурсов.

Изменить образ никак нельзя, можно только запустить контейнер, внести изменения,
и создать (build or commit) новый образ, в последующем используя его. При создании
образа вся мета-информация удаляется.

### UnionFS
Каждый образ состоит из последовательности слоев. Эти слои обьединяются в единный образ
посредством UNION FILE SYSTEM (прозрачно накладывает друг на друга "ветки" различный слоев).

Пример:
- ubuntu
- daemons
- run something
- nginx
- run something again
- (!extra) Read/Write-layer

После завершения контейнера последний слой стирается (тот самый экстра),
и все изменения (хранящиеся именно на "ветке" "экстры") - пропадают. НО!
Используя коммит или билд можно создать новый образ и зафиксировать изменения.

Весь набор уровней использующихся образом можно узнать командой: `docker history image_name`

##### P.S.
Важно помнить что каждая инструкция в докер-файле создает новый слой, а значит
нужно подчищать за собой если вдруг что-то скачиваешь
(ПОДЧИЩАТЬ БЛАГОДОРЯ ОДНОЛАЙНИКУ В РАМКАХ ТОГО ЖЕ СЛОЯ (ИНСТРУКЦИИ).
ВЕРХНИЙ СЛОЙ НЕ МОЖЕТ ИЗМЕНИТЬ НИЖНИЙ).

###### P.S.2
`... && rm -rf /var/lib/apt/lists/*` - удаляет лишнее после установки/обновления apt'a

## Docker-compose
docker-compose автоматизирует запуск сразу нескольких контейнеров и позволяет в
гибкую настройку (может коннектится с билдом (Dockerfile) и подсасывать его вместо image)
